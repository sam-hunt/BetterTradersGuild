<?xml version="1.0" encoding="utf-8"?>
<!--
  Better Traders Guild - TradersGuild_Slasher Patches

  Upgrades Slasher to spacer-level melee fighter:
  - MedievalMeleeAdvanced + UltratechMelee (Royalty)
  - Shield belt + Marine armor + Marine helmet (97% vacuum resistance)
  - 40% implant chance, 50% weapon biocoding
  - Good quality gear in better condition
-->
<Patch>

  <!-- Increase combat power: 140 → 160 -->
  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/PawnKindDef[defName="TradersGuild_Slasher"]</xpath>
    <value>
      <combatPower>160</combatPower>
    </value>
  </Operation>

  <!-- Override gear health: inherit 0.7~3.2 from SlasherBase → 1~1 (100% health) -->
  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/PawnKindDef[defName="TradersGuild_Slasher"]</xpath>
    <value>
      <gearHealthRange>1~1</gearHealthRange>
    </value>
  </Operation>

  <!-- Add item quality: Good -->
  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/PawnKindDef[defName="TradersGuild_Slasher"]</xpath>
    <value>
      <itemQuality>Good</itemQuality>
    </value>
  </Operation>

  <!-- Replace apparel tags: SpacerMilitary (armor) + IndustrialBasic (OnSkin underlayers) -->
  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/PawnKindDef[defName="TradersGuild_Slasher"]</xpath>
    <value>
      <apparelTags Inherit="False">
        <li>SpacerMilitary</li>
        <li>IndustrialBasic</li>
      </apparelTags>
    </value>
  </Operation>

  <!-- Increase apparel budget: 300~1400 → 2000~3500 -->
  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/PawnKindDef[defName="TradersGuild_Slasher"]</xpath>
    <value>
      <apparelMoney>2000~3500</apparelMoney>
    </value>
  </Operation>

  <!-- Replace weapon tags: remove MedievalMeleeDecent, keep only Advanced -->
  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/PawnKindDef[defName="TradersGuild_Slasher"]</xpath>
    <value>
      <weaponTags Inherit="False">
        <li>MedievalMeleeAdvanced</li>
      </weaponTags>
    </value>
  </Operation>

  <!-- Add UltratechMelee if Royalty DLC present -->
  <Operation Class="PatchOperationConditional">
    <xpath>/Defs/ThingDef[defName="MeleeWeapon_MonoSword"]</xpath>
    <match Class="PatchOperationAdd">
      <xpath>/Defs/PawnKindDef[defName="TradersGuild_Slasher"]/weaponTags</xpath>
      <value>
        <li>UltratechMelee</li>
      </value>
    </match>
  </Operation>

  <!-- Increase weapon budget: 200~500 → 2000~3000 (for ultratech weapons) -->
  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/PawnKindDef[defName="TradersGuild_Slasher"]</xpath>
    <value>
      <weaponMoney>2000~3000</weaponMoney>
    </value>
  </Operation>

  <!-- Override apparelRequired: ShieldBelt + Marine armor + Marine helmet (97% vacuum resistance) -->
  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/PawnKindDef[defName="TradersGuild_Slasher"]</xpath>
    <value>
      <apparelRequired Inherit="False">
        <li>Apparel_ShieldBelt</li>
        <li>Apparel_PowerArmor</li>
        <li>Apparel_PowerArmorHelmet</li>
      </apparelRequired>
    </value>
  </Operation>

  <!-- Increase implant chance: 15% → 40% -->
  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/PawnKindDef[defName="TradersGuild_Slasher"]</xpath>
    <value>
      <techHediffsChance>0.40</techHediffsChance>
    </value>
  </Operation>

  <!-- Increase implant budget: 700~1200 → 1000~2000 -->
  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/PawnKindDef[defName="TradersGuild_Slasher"]</xpath>
    <value>
      <techHediffsMoney>1000~2000</techHediffsMoney>
    </value>
  </Operation>

  <!-- Increase weapon biocoding: 20% → 80% -->
  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/PawnKindDef[defName="TradersGuild_Slasher"]</xpath>
    <value>
      <biocodeWeaponChance>0.80</biocodeWeaponChance>
    </value>
  </Operation>

  <!-- Add combat drugs chance: 35% -->
  <Operation Class="PatchOperationAdd">
    <xpath>/Defs/PawnKindDef[defName="TradersGuild_Slasher"]</xpath>
    <value>
      <combatEnhancingDrugsChance>0.35</combatEnhancingDrugsChance>
    </value>
  </Operation>

  <!-- Biotech: Override xenotype chances (40% Hussar, 10% Genie, 30% Starjack) -->
  <Operation Class="PatchOperationAdd" MayRequire="Ludeon.RimWorld.Biotech">
    <xpath>/Defs/PawnKindDef[defName="TradersGuild_Slasher"]</xpath>
    <value>
      <xenotypeSet>
        <xenotypeChances>
          <Hussar MayRequire="Ludeon.RimWorld.Biotech">0.40</Hussar>
          <Genie MayRequire="Ludeon.RimWorld.Biotech">0.10</Genie>
          <Starjack MayRequire="Ludeon.RimWorld.Biotech,Ludeon.RimWorld.Odyssey">0.30</Starjack>
        </xenotypeChances>
      </xenotypeSet>
    </value>
  </Operation>

</Patch>
